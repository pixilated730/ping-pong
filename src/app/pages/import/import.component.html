<!-- src/app/pages/import/import.component.html -->
<app-layout>
  <div class="max-w-3xl mx-auto space-y-6">
    <div>
      <h1 class="text-2xl font-semibold text-white">Import Key</h1>
      <p class="text-sm text-zinc-500 mt-1">Enter a private key or mnemonic to check balances</p>
    </div>

    <div class="glass rounded-xl p-6">
      <div class="flex flex-wrap items-center gap-4 mb-6 pb-4 border-b border-zinc-800">
        <span class="text-sm text-zinc-400">Chain:</span>
        <div class="flex gap-2">
          <button *ngFor="let chain of chains" (click)="selectedChain = chain" class="px-4 py-2 rounded-lg text-sm font-medium transition-all" [class.bg-orange-500]="selectedChain === chain" [class.text-white]="selectedChain === chain" [class.bg-zinc-800]="selectedChain !== chain" [class.text-zinc-400]="selectedChain !== chain">
            {{ chainNames[chain] }}
          </button>
        </div>
      </div>

      <div class="flex gap-2 mb-6">
        <button (click)="setMode('privateKey')" class="px-4 py-2 rounded-lg text-sm font-medium transition-all" [class.bg-white]="mode === 'privateKey'" [class.text-black]="mode === 'privateKey'" [class.bg-zinc-800]="mode !== 'privateKey'" [class.text-zinc-400]="mode !== 'privateKey'">Private Key</button>
        <button (click)="setMode('mnemonic')" class="px-4 py-2 rounded-lg text-sm font-medium transition-all" [class.bg-white]="mode === 'mnemonic'" [class.text-black]="mode === 'mnemonic'" [class.bg-zinc-800]="mode !== 'mnemonic'" [class.text-zinc-400]="mode !== 'mnemonic'">Mnemonic</button>
      </div>

      <div *ngIf="mode === 'privateKey'">
        <div class="mb-4">
          <label class="block text-sm text-zinc-400 mb-2">Private Key (HEX or WIF)</label>
          <input type="text" [(ngModel)]="privateKeyInput" placeholder="Enter private key..." class="w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-xl text-sm font-mono focus:outline-none focus:border-orange-500 placeholder-zinc-600">
        </div>
        <button (click)="importKey()" [disabled]="isProcessing || !privateKeyInput.trim()" class="px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 disabled:opacity-40 rounded-xl text-sm font-medium text-white shadow-lg shadow-orange-500/20 transition-all">
          {{ isProcessing ? 'Processing...' : 'Import & Check' }}
        </button>
      </div>

      <div *ngIf="mode === 'mnemonic'">
        <div class="mb-4">
          <label class="block text-sm text-zinc-400 mb-2">Mnemonic Phrase</label>
          <textarea [(ngModel)]="mnemonicInput" placeholder="Enter mnemonic phrase..." rows="3" class="w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-xl text-sm font-mono focus:outline-none focus:border-orange-500 placeholder-zinc-600 resize-none"></textarea>
        </div>
        <div class="grid sm:grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-sm text-zinc-400 mb-2">Derivation Path</label>
            <input type="text" [(ngModel)]="derivationPath" class="w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-xl text-sm font-mono focus:outline-none focus:border-orange-500">
          </div>
          <div>
            <label class="block text-sm text-zinc-400 mb-2">Addresses to Derive</label>
            <input type="number" [(ngModel)]="deriveCount" min="1" max="100" class="w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-xl text-sm font-mono focus:outline-none focus:border-orange-500">
          </div>
        </div>
        <div class="mb-4">
          <label class="block text-sm text-zinc-400 mb-2">Passphrase (optional)</label>
          <input type="password" [(ngModel)]="passphrase" placeholder="Leave empty if none" class="w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-xl text-sm font-mono focus:outline-none focus:border-orange-500 placeholder-zinc-600">
        </div>
        <div class="flex flex-wrap gap-2 mb-4">
          <span class="text-xs text-zinc-500">Quick:</span>
          <button (click)="setPath('btc-legacy')" class="text-xs px-2 py-1 bg-zinc-800 hover:bg-zinc-700 rounded text-zinc-400">BTC Legacy</button>
          <button (click)="setPath('btc-segwit')" class="text-xs px-2 py-1 bg-zinc-800 hover:bg-zinc-700 rounded text-zinc-400">BTC SegWit</button>
          <button (click)="setPath('eth')" class="text-xs px-2 py-1 bg-zinc-800 hover:bg-zinc-700 rounded text-zinc-400">ETH</button>
          <button (click)="setPath('sol')" class="text-xs px-2 py-1 bg-zinc-800 hover:bg-zinc-700 rounded text-zinc-400">SOL</button>
        </div>
        <button (click)="importMnemonic()" [disabled]="isProcessing || !mnemonicInput.trim()" class="px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 disabled:opacity-40 rounded-xl text-sm font-medium text-white shadow-lg shadow-orange-500/20 transition-all">
          {{ isProcessing ? 'Processing...' : 'Import & Check' }}
        </button>
      </div>

      <div *ngIf="processingStatus" class="mt-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
        <div class="flex items-center gap-2 text-blue-400 text-sm">
          <svg *ngIf="isProcessing" class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
          <span [class.text-emerald-400]="processingStatus.includes('found') || processingStatus.includes('sent')">{{ processingStatus }}</span>
        </div>
      </div>
    </div>

    <div *ngIf="error" class="glass rounded-xl p-4 border border-red-500/30 bg-red-500/10">
      <span class="text-sm text-red-400">{{ error }}</span>
    </div>

    <div *ngIf="result" class="glass rounded-xl overflow-hidden">
      <div class="p-4 border-b border-zinc-800">
        <div class="flex items-center justify-between">
          <h3 class="font-medium text-white">Key Details</h3>
          <span *ngIf="getTotalBalance() > 0" class="px-2 py-1 bg-emerald-500/20 text-emerald-400 rounded text-xs font-semibold">{{ formatBalance(getTotalBalance()) }} {{ selectedChain | uppercase }}</span>
        </div>
      </div>
      <div class="p-4 space-y-4">
        <div>
          <div class="text-xs text-zinc-500 mb-1">Private Key (HEX)</div>
          <div class="flex items-center gap-2">
            <code class="flex-1 text-xs font-mono text-amber-400 bg-black/30 rounded px-3 py-2 truncate">{{ result.privateKeyHex }}</code>
            <button (click)="copyToClipboard(result.privateKeyHex)" class="p-2 hover:bg-zinc-800 rounded text-zinc-500 hover:text-white">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
            </button>
          </div>
        </div>
        <div *ngIf="result.privateKeyWif">
          <div class="text-xs text-zinc-500 mb-1">Private Key (WIF)</div>
          <div class="flex items-center gap-2">
            <code class="flex-1 text-xs font-mono text-orange-400 bg-black/30 rounded px-3 py-2 truncate">{{ result.privateKeyWif }}</code>
            <button (click)="copyToClipboard(result.privateKeyWif || '')" class="p-2 hover:bg-zinc-800 rounded text-zinc-500 hover:text-white">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
            </button>
          </div>
        </div>
        <div>
          <div class="text-xs text-zinc-500 mb-2">Addresses</div>
          <div class="space-y-2">
            <div *ngFor="let addr of result.addresses" class="flex items-center gap-2 p-2 bg-black/30 rounded-lg" [class.ring-1]="addr.balance > 0" [class.ring-emerald-500]="addr.balance > 0">
              <span class="text-xs text-zinc-500 w-24">{{ addressLabels[addr.type] }}</span>
              <a [href]="getExplorerUrl(addr.chain, addr.address)" target="_blank" class="text-xs font-mono text-blue-400 hover:text-blue-300 truncate flex-1">{{ addr.address }}</a>
              <button (click)="copyToClipboard(addr.address)" class="p-1 hover:bg-zinc-800 rounded text-zinc-500 hover:text-white">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
              </button>
              <span *ngIf="addr.balance > 0" class="text-xs font-mono text-emerald-400 font-semibold">{{ formatBalance(addr.balance) }}</span>
              <span *ngIf="addr.checked && addr.balance === 0" class="text-xs text-zinc-600">Empty</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="mnemonicResults.length > 0" class="glass rounded-xl overflow-hidden">
      <div class="p-4 border-b border-zinc-800">
        <div class="flex items-center justify-between">
          <h3 class="font-medium text-white">Derived Keys ({{ mnemonicResults.length }})</h3>
          <span *ngIf="hasAnyBalance()" class="px-2 py-1 bg-emerald-500/20 text-emerald-400 rounded text-xs font-medium">{{ countWithBalance() }} with balance</span>
        </div>
      </div>
      <div class="max-h-[500px] overflow-y-auto">
        <div *ngFor="let item of mnemonicResults" class="border-b border-zinc-800 last:border-0 p-4" [class.bg-emerald-500]="item.hasBalance" [class.bg-opacity-5]="item.hasBalance">
          <div class="flex items-center justify-between mb-2">
            <span class="text-xs text-zinc-500 font-mono">{{ item.path }}</span>
            <div class="flex items-center gap-2">
              <span *ngIf="item.hasBalance" class="px-2 py-0.5 bg-emerald-500/20 text-emerald-400 rounded text-xs font-semibold">BALANCE</span>
              <button (click)="copyToClipboard(item.privateKey)" class="p-1 hover:bg-zinc-800 rounded text-zinc-500 hover:text-white" title="Copy key">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
              </button>
            </div>
          </div>
          <code class="text-xs font-mono text-amber-400 block truncate mb-2 bg-black/30 rounded px-2 py-1">{{ item.privateKey }}</code>
          <div class="space-y-1">
            <div *ngFor="let addr of item.addresses" class="flex items-center gap-2 text-xs p-1.5 rounded" [class.bg-emerald-500]="addr.balance > 0" [class.bg-opacity-10]="addr.balance > 0">
              <span class="text-zinc-500 w-20">{{ addressLabels[addr.type] }}</span>
              <a [href]="getExplorerUrl(addr.chain, addr.address)" target="_blank" class="font-mono text-zinc-400 hover:text-blue-400 truncate flex-1">{{ addr.address }}</a>
              <span *ngIf="addr.balance > 0" class="text-emerald-400 font-semibold">{{ formatBalance(addr.balance) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</app-layout>
